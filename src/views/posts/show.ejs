<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CP KKU Study Notes</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>

<main class="container">
<article class="post">
  <% if (post.coverImage){ %><img src="<%= post.coverImage %>" class="cover-xl"/><% } %>
  <h1><%= post.title %></h1>
  <p class="muted">‡πÇ‡∏î‡∏¢ <%= post.author?.username %> ¬∑ ‚ô• <%= post.likes.length %> ¬∑ üëÅÔ∏è <%= post.views %></p>
  <div class="tags">
    <% (post.tags||[]).forEach(t=>{ %><span class="tag"><%= t %></span><% }) %>
  </div>
  <p><%= post.body %></p>
  <div class="row">
    <form method="post" action="/posts/<%= post.slug %>/like"><button>‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</button></form>
    <% if (currentUser && (currentUser.id === String(post.author._id) || currentUser.role==='admin')){ %>
      <a class="button" href="/posts/<%= post.slug %>/edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
      <form method="post" action="/posts/<%= post.slug %>/delete"><button class="danger">‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå</button></form>
    <% } else if (currentUser) { %>
      <a class="button" href="/posts/<%= post.slug %>/report">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
    <% } %>
  </div>
  <hr/>
  <h3>‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</h3>
  <ul class="comments">
    <% post.comments.forEach(c=>{ %>
      <li><b><%= c.author?.username %></b> <span class="muted"><%= new Date(c.createdAt).toLocaleString() %></span><br/><%= c.body %></li>
    <% }) %>
  </ul>
  <% if (currentUser){ %>
  <form method="post" action="/posts/<%= post.slug %>/comments">
    <textarea name="body" rows="3" required></textarea>
    <button>‡∏™‡πà‡∏á‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</button>
  </form>
  <% } else { %><p class="muted">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</p><% } %>
</article>
</main>
</body>
</html>
